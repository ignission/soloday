{
	"id": "snapshot_1769395390919_37145pahj",
	"approvalId": "approval_1769395390895_73u8ikq00",
	"approvalTitle": "Onboarding Requirements Document",
	"version": 1,
	"timestamp": "2026-01-26T02:43:10.919Z",
	"trigger": "initial",
	"status": "pending",
	"content": "# Requirements Document: Onboarding\n\n## Introduction\n\nmiipaの初回起動時にユーザーがスムーズにセットアップを完了できるオンボーディングフローを提供します。\n\n一人社長が「30秒で設定完了」できるシンプルなUXを最優先とし、LLMプロバイダの選択からAPIキーの安全な保存まで、最小限のステップで完了できることを目指します。\n\n## Alignment with Product Vision\n\nこのオンボーディング機能は、miipaの「今日/今週の自分を30秒で把握」というビジョンを実現するための入り口となります。\n\n- **シンプルさ**: 情報過多にしない、必要最小限のステップ\n- **セキュリティ**: APIキーはmacOS Keychainに安全に保存（平文禁止）\n- **マルチプロバイダ対応**: Claude / OpenAI / Ollamaの選択肢を提供\n- **ローカル実行**: 外部サーバーへの依存なし\n\n## 前提条件\n\n以下の基盤がproject-setupで実装済み:\n\n- Keychain統合（`getSecret`, `setSecret`, `deleteSecret`, `hasSecret`）\n- 設定ファイル管理（`~/.miipa/config.json`）\n- 設定ローダー（`loadOrInitializeConfig`, `saveConfig`）\n- Result型・Option型によるエラーハンドリング\n\n## Requirements\n\n### Requirement 1: 初回起動検出\n\n**User Story:** 一人社長として、アプリを初めて起動したとき、セットアップ画面に自動的に案内されたい。それにより、何をすべきか迷わずに始められる。\n\n#### Acceptance Criteria\n\n1. WHEN ユーザーがアプリケーションを起動する AND 設定ファイル（`~/.miipa/config.json`）が存在しない THEN システム SHALL セットアップ画面（`/setup`）にリダイレクトする\n\n2. WHEN ユーザーがアプリケーションを起動する AND 設定ファイルは存在する AND LLMプロバイダのAPIキーがKeychainに保存されていない THEN システム SHALL セットアップ画面（`/setup`）にリダイレクトする\n\n3. WHEN ユーザーがアプリケーションを起動する AND 設定ファイルが存在する AND LLMプロバイダのAPIキーがKeychainに保存されている THEN システム SHALL メイン画面（`/`）を表示する\n\n4. IF セットアップ完了済みのユーザーが手動で`/setup`にアクセスする THEN システム SHALL 設定変更モードとしてセットアップ画面を表示する\n\n### Requirement 2: LLMプロバイダ選択\n\n**User Story:** 一人社長として、使いたいLLMプロバイダを3つの選択肢から選びたい。それにより、自分の環境や好みに合ったAIを使える。\n\n#### Acceptance Criteria\n\n1. WHEN セットアップ画面を表示する THEN システム SHALL 以下のプロバイダ選択肢を表示する:\n   - Claude（Anthropic） - 推奨として強調表示\n   - OpenAI（GPT）\n   - Ollama（ローカル）\n\n2. WHEN ユーザーがプロバイダを選択する THEN システム SHALL 選択されたプロバイダを視覚的にハイライトする\n\n3. WHEN ユーザーがClaudeまたはOpenAIを選択する THEN システム SHALL APIキー入力ステップに進む\n\n4. WHEN ユーザーがOllamaを選択する THEN システム SHALL Ollama接続確認ステップに進む（APIキー不要のため）\n\n5. IF プロバイダが選択されていない状態で次へ進もうとする THEN システム SHALL エラーメッセージを表示し、プロバイダ選択を促す\n\n### Requirement 3: APIキー入力と検証\n\n**User Story:** 一人社長として、APIキーを入力して正しいことを確認したい。それにより、設定ミスによるエラーを避けられる。\n\n#### Acceptance Criteria\n\n1. WHEN APIキー入力画面を表示する THEN システム SHALL 以下を表示する:\n   - 選択したプロバイダのロゴとプロバイダ名\n   - APIキー入力フィールド（パスワードマスク表示）\n   - APIキー取得方法へのリンク（各プロバイダの設定ページ）\n   - 「検証する」ボタン\n\n2. WHEN ユーザーがAPIキーを入力して「検証する」ボタンをクリックする THEN システム SHALL APIキーの形式を検証する:\n   - Claude: `sk-ant-` で始まる文字列\n   - OpenAI: `sk-` で始まる文字列\n\n3. WHEN APIキーの形式が正しい THEN システム SHALL プロバイダAPIへテスト接続を実行する\n\n4. WHEN テスト接続が成功する THEN システム SHALL 成功メッセージを表示し、次のステップへ進むボタンを有効化する\n\n5. WHEN テスト接続が失敗する THEN システム SHALL エラーメッセージを表示する（「APIキーが無効です」「接続できません」など具体的なメッセージ）\n\n6. IF APIキーフィールドが空の状態で「検証する」ボタンをクリックする THEN システム SHALL 「APIキーを入力してください」というエラーメッセージを表示する\n\n7. WHEN Ollamaが選択されている THEN システム SHALL ローカルサーバー（デフォルト: `http://localhost:11434`）への接続テストを実行する\n\n### Requirement 4: APIキーの安全な保存\n\n**User Story:** 一人社長として、APIキーを安全に保存したい。それにより、セキュリティリスクを心配せずに使える。\n\n#### Acceptance Criteria\n\n1. WHEN APIキー検証が成功し、ユーザーが「保存して完了」をクリックする THEN システム SHALL APIキーをmacOS Keychainに保存する\n\n2. WHEN APIキーをKeychainに保存する THEN システム SHALL 以下のキー名を使用する:\n   - Claude: `anthropic-api-key`\n   - OpenAI: `openai-api-key`\n   - Ollama: `ollama-api-key`（Ollamaの場合は接続URLを保存）\n\n3. WHEN Keychainへの保存が成功する THEN システム SHALL 設定ファイル（`~/.miipa/config.json`）の`llm.provider`を更新する\n\n4. WHEN Keychainへの保存が失敗する THEN システム SHALL エラーメッセージを表示し、リトライを促す\n\n5. IF 既存のAPIキーがKeychainに存在する THEN システム SHALL ユーザーに上書き確認を行い、承認後に上書き保存する\n\n### Requirement 5: セットアップ完了確認\n\n**User Story:** 一人社長として、セットアップが正常に完了したことを確認したい。それにより、安心してアプリを使い始められる。\n\n#### Acceptance Criteria\n\n1. WHEN すべての設定が正常に保存される THEN システム SHALL 完了画面を表示する\n\n2. WHEN 完了画面を表示する THEN システム SHALL 以下を表示する:\n   - 設定完了メッセージ（ミーアキャットキャラクターの祝福イラスト付き）\n   - 選択したプロバイダ名の確認\n   - 「miipaを始める」ボタン\n\n3. WHEN ユーザーが「miipaを始める」ボタンをクリックする THEN システム SHALL メイン画面（`/`）に遷移する\n\n4. WHEN 完了画面表示後5秒間操作がない THEN システム SHALL 自動的にメイン画面へ遷移する（オプション機能）\n\n### Requirement 6: 設定変更（再セットアップ）\n\n**User Story:** 一人社長として、後からLLMプロバイダやAPIキーを変更したい。それにより、別のプロバイダを試したり、キーを更新したりできる。\n\n#### Acceptance Criteria\n\n1. WHEN セットアップ完了済みユーザーが`/setup`にアクセスする THEN システム SHALL 現在の設定を表示した状態でセットアップ画面を表示する\n\n2. WHEN 設定変更モードで表示する THEN システム SHALL 以下を表示する:\n   - 現在選択中のプロバイダ（ハイライト表示）\n   - 「キーを変更する」ボタン\n   - 「キャンセル」ボタン（メイン画面に戻る）\n\n3. WHEN ユーザーが別のプロバイダを選択する THEN システム SHALL 新しいプロバイダ用のAPIキー入力画面に進む\n\n4. WHEN 設定変更をキャンセルする THEN システム SHALL 変更を破棄し、メイン画面に戻る\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n\n- **Single Responsibility Principle**: セットアップUIコンポーネント、APIキー検証ロジック、Keychain操作は分離する\n- **Modular Design**: 各ステップ（プロバイダ選択、キー入力、完了）は独立したコンポーネントとして実装\n- **Dependency Management**: 既存の`lib/infrastructure/keychain`と`lib/config`モジュールを活用\n- **Clear Interfaces**: 各コンポーネント間のデータフローを明確に定義（props、コールバック）\n\n### Performance\n\n- セットアップ画面の初期表示は1秒以内\n- APIキー検証は3秒以内に結果を返す（タイムアウト設定）\n- Keychain操作は100ms以内に完了\n\n### Security\n\n- APIキーは画面上でマスク表示（`type=\"password\"`）\n- APIキーはメモリ上に一時保持し、保存後は即座にクリア\n- APIキーは絶対に設定ファイルやログに出力しない\n- すべてのAPIキーはmacOS Keychainにのみ保存\n- HTTPS経由でのみプロバイダAPIと通信\n\n### Reliability\n\n- ネットワークエラー時は具体的なエラーメッセージを表示\n- 操作途中でブラウザを閉じても、次回起動時に途中から再開可能\n- Keychain操作エラー時はリトライ可能なUIを提供\n\n### Usability\n\n- 全体のフローは3ステップ以内（プロバイダ選択 → キー入力 → 完了）\n- 各ステップに進捗インジケータを表示\n- プロバイダごとのヘルプリンク（APIキー取得方法）を提供\n- エラーメッセージは日本語で具体的に（「不明なエラー」は避ける）\n- キーボードショートカット対応（Enter で次へ、Escape でキャンセル）\n\n### Accessibility\n\n- キーボードナビゲーション対応\n- スクリーンリーダー対応（適切なaria属性）\n- 十分なコントラスト比（WCAG AA準拠）\n\n## Out of Scope\n\n- Google Calendar OAuth認証（別仕様で実装）\n- カレンダー設定（別仕様で実装）\n- モデル選択機能（MVP後に検討）\n- Ollamaモデルダウンロード機能\n- 多言語対応（日本語のみ）\n",
	"fileStats": {
		"size": 10455,
		"lines": 191,
		"lastModified": "2026-01-26T02:43:05.956Z"
	},
	"comments": []
}
